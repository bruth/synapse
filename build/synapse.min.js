/*
Synapse - The Backbone KVO Library

Author: Byron Ruth
Version: 0.1
Date: Fri Jul 15 17:29:02 2011 -0500
*/var __slice=Array.prototype.slice;(function(a){var b,c,d,e,f;_.isObject||(_.isObject=function(a){return a===Object(a)}),d={autoExtendObjects:!0,debug:!1},f=this.Synapse||{},_.defaults(f,d),b=function(){var a;a=function(b){return new a.fn.init(b)},a.version="0.1",a.guid=1,a.cache={},a.conf=f,a.log=function(){if(a.conf.debug)try{return console.log.apply(console,arguments)}catch(b){try{return opera.postError.apply(opera,arguments)}catch(b){return alert(Array.prototype.join.call(arguments," "))}}},a.types={object:0,jquery:1,model:2,collection:3,view:4,router:5},a.getObjectType=function(b){var c;if(b instanceof $)return a.types.jquery;if(b instanceof Backbone.Model)return a.types.model;if(b instanceof Backbone.Collection)return a.types.collection;if(b instanceof Backbone.View)return a.types.view;if(b instanceof Backbone.Router)return a.types.router;for(c in Backbone.Events)if(!b[c]){if(!a.conf.autoExtendObjects)throw new Error("object does not support events and 'autoExtendObjects' is turned off");_.extend(b,Backbone.Events);break}return a.types.object},a.fn=a.prototype={constructor:a,observers:{},notifiers:{},init:function(b){if(b instanceof a)return b;_.isString(b)||_.isElement(b)?b=$.apply($,arguments):$.isPlainObject(b)&&_.extend(b,Backbone.Events),this.guid=a.guid++,this.type=a.getObjectType(b),this.context=b,a.cache[this.guid]=this;return this},bind:function(){return this.context.bind.apply(this,arguments)},unbind:function(){return this.context.unbind.apply(this,arguments)},trigger:function(){return this.context.trigger.apply(this,arguments)},get:function(b){if(this.context.get)return this.context.get.call(this.context,b);return a.interfaces.get(this.context,b)},set:function(b,c){if(this.context.set)return this.context.set.call(this.context,b,c);return a.interfaces.set(this.context,b,c)},sync:function(a){return this.observe(a).notify(a)},observe:function(b,c){a.register(this,b,c,!1);return this},notify:function(b,c){a.register(b,this,c,!0);return this}},a.fn.init.prototype=a.fn;return a}(),b.defaultDomEvents=[["a,:button,:reset","click"],["select,:checkbox,:radio,textarea","change"],[":submit","submit"],[":input","keyup"]],b.detectDomEvent=function(a){var c,d,e,f,g,h;h=b.defaultDomEvents;for(f=0,g=h.length;f<g;f++){d=h[f],e=d[0],c=d[1];if(a.context.is(e))return c}throw new Error("Event for "+a+" could not be detected.")},b.getEvents=function(a,c){var d;if(!c)if(a.type===b.types.jquery)d=[b.detectDomEvent(a)];else if(a.type===b.types.model)d=["change"];else throw new Error("No event defined for subject");else d=_.isArray(c)?c:[c];return d},b.handlers={0:{send:function(a,b,c,d,d){a.bind(b,function(){var a;a=this.get(c);return d(this.context,c,a)});if(d)return a.context.trigger(b)},receive:function(a,b,c){return function(d,e){c&&(e=c(a.context,b,e));return a.set(b,e)}}},1:{send:function(a,b,c,d){a.bind(b,function(){var a;a=this.get(c);return d(this.context,c,a)});if(d)return a.trigger(b)},receive:function(a,b,c){return function(a,d){c&&(d=c(this.context,b,d));return this.set(b,d)}}},2:{send:function(a,b,c,d){c&&(b=""+b+":"+c),a.bind(b,function(a,b,e){return d(this.context,c,b)});if(d)return a.trigger(b,a,a.get(c))},receive:function(a,b,c){return function(a,d){var e;c&&(d=c(this.context,b,d)),e={},e[b]=d;return this.set(e)}}}},b.defaultElementInterfaces=[[":checkbox","checked"],[":radio","checked"],["button","html"],[":input","value"],["*","text"]],b.detectElementInterface=function(a){var c,d,e,f,g,h;h=b.defaultElementInterfaces;for(f=0,g=h.length;f<g;f++){d=h[f],e=d[0],c=d[1];if(a.context.is(e))return c}throw new Error("Interface for "+a+" could not be detected.")},e=function(a,b){a?_.isArray(a)?_.isArray(a[0])||(a=[a]):a=b?[[a,null]]:[[null,a]]:a=[[null,null]];return a},b.getInterfaces=function(a,c,d,f){var g,h,i,j,k,l,m,n,o,p,q,r;f==null&&(f=!0),d=e(d,f);for(j=0,k=d.length;j<k;j++){h=d[j],f?(m=[0,1],i=m[0],g=m[1]):(n=[1,0],g=n[0],i=n[1]),r=null,l=null;if(a.type===b.types.jquery){r=b.detectElementInterface(a);if((o=c.type)===b.types.model||o===b.types.object)l=a.context.attr("name")||null}c.type===b.types.jquery&&(l=b.detectElementInterface(c),r||(r=c.context.attr("name")||null)),r===null&&a.type===b.types.model&&(r=""),(p=h[i])!=null?p:h[i]=r,(q=h[g])!=null?q:h[g]=l;if(h[i]===null||h[g]===null)throw new Error("The interfaces between "+a+" and "+c+" could be detected")}return d},b.interfaces=function(){return{registry:{},register:function(a){return this.registry[a.name]=a},unregister:function(a){return delete this.registry[a]},get:function(){var a,c,d,e,f;c=arguments[0],e=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[],c instanceof b&&(c=c.context),f=e.split(":"),e=f[0],d=f[1],d!=null&&(a=[d].concat(a));return this.registry[e].get.apply(c,a)},set:function(){var a,c,d,e,f;c=arguments[0],e=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[],c instanceof b&&(c=c.context),f=e.split(":"),e=f[0],d=f[1],d!=null&&(a=[d].concat(a));return this.registry[e].set.apply(c,a)}}}(),function(){var a,c,d,e,f,g;c=function(b){if(this.prop!=null)return this.prop(b);return a.call(this,b)},f=function(a,b){if(this.prop!=null){if(typeof a=="object")return this.prop(a);return this.prop(a,b)}return e.call(this,a,b)},a=function(a){return this.attr(a)},e=function(a,b){if(typeof a=="object")return this.attr(a);return this.attr(a,b)},d=function(a){return this.css(a)},g=function(a,b){if(typeof a=="object")return this.css(a);return this.css(a,b)},b.interfaces.register({name:"prop",get:function(a){return c.call(this,a)},set:function(a,b){return f.call(this,a,b)}}),b.interfaces.register({name:"attr",get:function(b){return a.call(this,b)},set:function(a,b){return e.call(this,a,b)}}),b.interfaces.register({name:"style",get:function(a){return d.call(this,a)},set:function(a,b){return g.call(this,a,b)}}),b.interfaces.register({name:"text",get:function(){return this.text()},set:function(a){return this.text((a||(a=""))+"")}}),b.interfaces.register({name:"html",get:function(){return this.html()},set:function(a){return this.html((a||(a=""))+"")}}),b.interfaces.register({name:"value",get:function(){return this.val()},set:function(a){return this.val(a||(a=""))}}),b.interfaces.register({name:"enabled",get:function(){return!c.call(this,"disabled")},set:function(a){_.isArray(a)&&a.length===0&&(a=!1);return f.call(this,"disabled",!Boolean(a))}}),b.interfaces.register({name:"disabled",get:function(){return c.call(this,"disabled")},set:function(a){_.isArray(a)&&a.length===0&&(a=!1);return f.call(this,"disabled",Boolean(a))}}),b.interfaces.register({name:"checked",get:function(){return c.call(this,"checked")},set:function(a){_.isArray(a)&&a.length===0&&(a=!1);return f.call(this,"checked",Boolean(a))}}),b.interfaces.register({name:"visible",get:function(){return d.call(this,"display")===!1},set:function(a){_.isArray(a)&&a.length===0&&(a=!1);return Boolean(a)?this.show():this.hide()}}),b.interfaces.register({name:"hidden",get:function(){return d.call(this,"display")==="none"},set:function(a){_.isArray(a)&&a.length===0&&(a=!1);return Boolean(a)?this.hide():this.show()}});return b.interfaces.register({name:"css",get:function(a){return this.hasClass(a)},set:function(a,b){_.isArray(b)&&b.length===0&&(b=!1);return Boolean(b)?this.addClass(a):this.removeClass(a)}})}(),c={events:null,interfaces:null,handler:null,notifyInit:!0},b.registerSync=function(a,c){b.registerObserver(a,c);return b.registerObserver(c,a)},b.register=function(a,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;a instanceof b||(n=b(a)),d instanceof b||(m=b(d)),f?(w=[a,d],m=w[0],n=w[1]):(x=[a,d],n=x[0],m=x[1]),m.observers[n.guid]||(m.observers[n.guid]={}),n.notifiers[m.guid]||(n.notifiers[m.guid]={}),p={},_.isString(e)||_.isArray(e)?e={"interface":e}:_.isFunction(e)&&(e={handler:e}),_.extend(p,c,e),i=b.getEvents(m,p.event),l=b.getInterfaces(m,n,p.interface),j=p.handler,j&&!_.isFunction(j)&&(j=n[j]),q=b.handlers[n.type].receive,r=b.handlers[m.type].send,y=[];for(t=0,u=i.length;t<u;t++)h=i[t],m.observers[n.guid][h]=!0,n.notifiers[m.guid][h]=!0,y.push(function(){var a,b,c;c=[];for(a=0,b=l.length;a<b;a++)g=l[a],s=g[0],o=g[1],v=q(n,o,r),_.isArray(s)||(s=[s]),c.push(function(){var a,b,c;c=[];for(a=0,b=s.length;a<b;a++)k=s[a],c.push(r(m,h,k,v,p.notifyInit));return c}());return c}());return y};return a.Synapse=a.SYN=b})(window)