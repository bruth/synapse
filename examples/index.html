<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        
        <title>Syanpse</title>
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="css/ir_black.css">
        <link rel="stylesheet" href="css/style.css">
        <style>
            .red { color: red; }
        </style>

        <script src="js/jquery.js"></script>
        <script src="js/underscore.js"></script>
        <script src="js/backbone.js"></script>
        <script src="js/synapse.js"></script>
        <script src="js/highlight.pack.js"></script>
        <script>
            hljs.tabReplace = '    ';
            hljs.initHighlightingOnLoad();
        </script>

        <script>
            function assert(expr) { return Boolean(expr); }

            $(function() {

                // example pre
                var prim = {},
                    sPrim = Synapse(prim);
                $('#example-pre span').text(assert(prim === sPrim.context));

                // example 0
                var model = new Backbone.Model({ title: 'Hello World' });
                Synapse('#example0-1 input').sync(model);
                Synapse('#example0-1 .output').observe(model, 'title');
                Synapse('#example0-1 .meta').observe(model, function() {
                    return 'Last updated: ' + (new Date()).toString();
                });

                var Model = Backbone.Model.extend({
                    fullName: function() {
                        return this.get('firstName') + ' ' + this.get('lastName');
                    }
                });

                var model = new Model;
                Synapse(model)
                    .sync('#example0-2 [name=firstName]')
                    .sync('#example0-2 [name=lastName]')
                    .notify('#example0-2 .fullName', 'fullName');

                var Model = Backbone.Model.extend({
                    defaults: { clicks: 0 },
                    addClick: function() {
                        this.set({clicks: this.get('clicks')+1});
                    },
                    hasTooManyClicks: function() {
                        return this.get('clicks') >= 3;
                    },
                    resetClicks: function() {
                        this.set({clicks: this.defaults.clicks});
                    }
                });

                var model = new Model;

                Synapse(model)
                    .observe('#example0-3 .clicker', {
                        observerInterface: 'addClick',
                        triggerOnBind: false
                    })
                    .notify('.clicks', [
                        { subjectInterface: 'clicks' },
                        { subjectInterface: 'hasTooManyClicks', observerInterface: 'css:red' }
                    ])
                    .notify('#example0-3 .clicker', 'hasTooManyClicks', 'disabled') 
                    .notify('#example0-3 .message', 'hasTooManyClicks', 'visible');

                Synapse('#example0-3 .reset').notify(model, {observerInterface: 'resetClicks'});

                // example 1 
                Synapse('#example1-1 span').observe('#example1-1 input');
                Synapse('#example1-2 input.one').sync('#example1-2 input.two');
                Synapse('#example1-3 :text').observe('#example1-3 :checkbox', 'checked', 'enabled');
                Synapse('#example1-4 span').observe('#example1-4 input', {
                    subjectInterface: 'value',
                    observerInterface: 'html',
                    converter: function(value) {
                        if (value !== '')
                            return 'I am a <b>' + value + '</b>';
                        return '<em class="meta">please type something</em>';
                    }
                });

                // example 2
                var bprim = Synapse({}).observe('#example2-1 input').notify('#example2-1 span', {
                    event: 'change',
                    subjectInterface: 'foo',
                    observerInterface: 'text'
                });

                setInterval(function() {
                    bprim.trigger('change');
                }, 100);

            });
        </script>

    </head>
    <body>        

        <h1>Synapse (The Backbone KVO Library)</h1>

        <p class="meta"><a href="./test/">View tests</a> (only tested in Chrome)</p>

        <h3>The Basics</h3>

        <div class="example">
            <div>
<pre class="javascript">
<code>// Synapse supports object primitives
var obj = {};

// simple constructor to wrap objects for use with the API, returns
// the Synapse object.
// the original object is a property called ``context``.
assert(Synapse(obj).context === prim);
</code></pre>
            </div>
            <div id="example-pre">
                <code>assert(prim === bprim.context)</code><br>
                <span class="meta"></span>
            </div>
        </div>

        <h3>DOM to Model</h3>

        <div class="example">
            <div>
<pre class="javascript">
<code>// initialize a new model object 
var model = new Backbone.Model({ title: 'Hello World' });

// the model will observe the value of this input (the attribute
// is equal to the 'name' attribute on the input, i.e. 'title'
Synapse('input').sync(model);

// the span will observe the 'title' attribute on this model
Synapse('span').observe(model, 'title');

// if no interface is auto-detected for the model, the observer
// will be notified when _anything_ changes.
Synapse('.meta').observe(model, function() {
    return 'Last updated: ' + (new Date()).toString();
});
</code></pre>
            </div>

            <div id="example0-1">
                <input type="text" name="title">
                <span class="output"></span><br>
                <span class="meta"></span>
            </div>
        </div>


        <div class="example">
            <div>
<pre class="javascript">
<code>var Model = new Backbone.Model.extend({
    fullName: function() {
        return this.get('firstName') + ' ' + this.get('lastName');
    }
});

Synapse(new Model)
    .observe('[name=firstName]')
    .observe('[name=lastName]')
    .notify('.fullName', 'fullName');
</code></pre>
            </div>
            <div id="example0-2">
                First name: <input type="text" name="firstName" value="Planet"><br>
                Last name: <input type="text" name="lastName" value="Earth"><br><br>
                Hello, <span class="fullName"></span>
            </div>
        </div>

        <div class="example">
            <div>
<pre class="javascript">
<code>var Model = Backbone.Model.extend({
    defaults: { clicks: 0 },
    addClick: function() {
        this.set({ clicks: this.get('clicks')++ });
    },
    hasTooManyClicks: function() {
        return this.get('clicks') &gt;= 3;
    },
    resetClicks: function() {
        this.set({ clicks: this.defaults.clicks });
    }
});

var model = new Model;

Synapse(model)
    // watch the "Click Me!" button on each click
    .observe('.clicker', {
        observerInterface: 'addClick',
        triggerOnBind: false
    })
    // notify the counter of the clicks and update clicks
    // if it reaches too many
    .notify('.clicks', [
        { subjectInterface: 'clicks' },
        { subjectInterface: 'hasTooManyClicks', observerInterface: 'css:red' }
    ])
     
    .notify('.clicker', 'hasTooManyClicks', 'disabled') 
    .notify('.message', 'hasTooManyClicks', 'visible');

Synapse('.reset').notify(model, {observerInterface: 'resetClicks'});
</code></pre>
            </div>
            <div id="example0-3">
                You've clicked <span class="clicks"></span><br>
                <button class="clicker">Click Me!</button>
                <span class="message">
                    Too many clicks... <button class="reset">Reset Clicks</button>
                </span>
            </div>
        </div>





        <h3>DOM to DOM</h3>

        <p></p>

        <div class="example">
            <div>
<pre class="javascript"><code>// the ``span`` observes the ``input``. Synapse autodetects to use
// the "html" interface for the ``span`` and the "value" of  the
// ``input``. The event is auto-detected relative to the subject type,
// which will be "keyup".
Synapse('span').observe('input');
</code></pre>
            </div>

            <div id="example1-1">
                <input type="text">
                <span class="output"></span>
            </div>
        </div>

        <div class="example">
            <div>
<pre class="javascript"><code>// actionable objects (ones that have detectable events) can be 
// synced. that is, both are observing each other. this merely a
// convenience syntax and can be accomplished using two ``observe()``
// calls
Synapse('input.one').sync('input.two');
</code></pre>
            </div>

            <div id="example1-2">
                <input class="one" type="text">
                <input class="two" type="text">
            </div>
        </div>

        <div class="example">
            <div>
<pre class="javascript"><code>// interfaces can be explicitly set. this one reads, the ``:text``
// input will be "enabled" only when the ``:checkbox`` is "checked".
Synapse(':text').observe(':checkbox', 'enabled', 'checked');
</code></pre>
            </div>

            <div id="example1-3">
                <input type="checkbox">
                <input class="one" type="text" value="can you edit me?">
            </div>
        </div>

        <div class="example">
            <div>
<pre class="javascript"><code>// add a handler that takes the subject and value that has changed
// state as arguments. the returned values from the handler will be
// used as the value for the observers interface.
Synapse('span').observe('input', {
    subjectInterface: 'value',
    observerInterface: 'html',
    handler: function(value) {
        if (value !== '')
            return 'I am a &lt;b&gt;' + value + '&lt;/b&gt;';
        return '&lt;em class="meta"&gt;please type something&lt;/em&gt;';
    }
});</code></pre>
            </div>

            <div id="example1-4">
                <input type="text">
                <span class="output"></span>
            </div>
        </div>

        <h3>Primitives</h3>

        <div class="example">
            <div>
<pre class="javascript"><code>// a simple primitive is keeping track of the
// value of the input field. the property will be the input's name
// attribute
var sPrim = Synapse({}).observe('input').notify('span', {
    subjectInterface: 'foo',
    observerInterface: 'text',
    event: 'change'
});

// to emulate the trigger, we just set an interval for every 100ms
setInterval(function() {
    sPrim.trigger('change');
}, 100);

</code></pre>
            </div>

            <div id="example2-1">
                <input type="text" name="foo">
                <span></span>
            </div>
        </div>

        <script>
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-8483912-3']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>

    </body>
</html>

