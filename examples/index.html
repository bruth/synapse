<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        
        <title>Backbone KVO</title>
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="css/ir_black.css">

        <style>
            body {
                font-family: 'droid sans', sans-serif;
                background-color: #eee;
                text-shadow: 0 1px 1px #fff;
            }

            pre, code {
                font-family: 'm+ 1m', monospace;
                font-size: 0.9em;
                margin: 0;
            }

            pre code {
                text-shadow: none;
                border-radius: 5px;
            }

            p > code {
                border-bottom: 1px solid #ccc;
                background-color: #f9f9f9;
                padding: 2px;
            }

            input {
                border: 1px solid #999;
                padding: 3px;
            }

            input:disabled {
                border: 1px solid #ccc;
                background-color: #f9f9f9;
                color: #aaa;
            }

            em {
                font-size: 0.9em;
            }

            h3 {
                margin: 20px 0 10px 0;
            }

            .example {
                margin: 10px 0;
            }

            .example > p {
                color: #184489;
                border-bottom: 1px solid #ddd;
                margin: 0;
                margin-bottom: 10px;
                padding-bottom: 10px;
                line-height: 1.4em;
            }

            .example > div {
                display: inline-block;
                *display: inline;
                vertical-align: middle;
                zoom: 1;
            }

            .example > div:nth-child(odd) {
                width: 500px;
                margin-right: 20px;
            }

            .example > div:nth-child(even) {
                padding: 10px;
                background: #fff;
                border: 1px solid #999;
                box-shadow: 1px 2px 5px #aaa;
                min-width: 400px;
            }

            .meta {
                font-size: 0.8em;
                color: #999;
            }

            input[type=text], .output {
                width: 150px;
            }

            .output {
                display: inline-block;
                *display: inline;
                zoom: 1;
                border-bottom: 1px dotted #666;
                vertical-align: bottom;
            }

        </style>

        <script src="js/jquery.js"></script>
        <script src="js/underscore.js"></script>
        <script src="js/backbone.js"></script>
        <script src="js/bkvo.js"></script>
        <script src="js/highlight.pack.js"></script>
        <script>
            hljs.tabReplace = '    ';
            hljs.initHighlightingOnLoad();
        </script>

        <script>
            function assert(expr) { return Boolean(expr); }

            $(function() {

                // example pre
                var prim = {},
                    bprim = BKVO(prim);
                $('#example-pre span').text(assert(prim === bprim.object));

                // example 0
                var model = new Backbone.Model({ title: 'Hello World' });
                BKVO('#example0-1 input').sync(model);
                BKVO('#example0-1 .output').observe(model, 'title');
                BKVO('#example0-1 .meta').observe(model, function() {
                    return 'Last updated: ' + (new Date()).toString();
                });


                // example 1 
                BKVO('#example1-1 span').observe('#example1-1 input');
                BKVO('#example1-2 input.one').sync('#example1-2 input.two');
                BKVO('#example1-3 :text').observe('#example1-3 :checkbox',{
                    interface: {enabled: 'checked'}
                });
                BKVO('#example1-4 span').observe('#example1-4 input', {
                    interface: {'html': 'value'},
                    handler: function(object, value) {
                        if (value !== '')
                            return 'I am a <b>' + value + '</b>';
                        return '<em class="meta">please type something</em>';
                    }
                });

                // example 2
                var bprim = BKVO({}).observe('#example2-1 input').notify('#example2-1 span', {
                    interface: {text: 'foo'},
                    event: 'change'
                });

                setInterval(function() {
                    bprim.object.trigger('change');
                }, 100);

            });
        </script>

    </head>
    <body>        

        <h1>Backbone KVO</h1>

        <h3>The Basics</h3>

        <div class="example">
            <div>
<pre class="javascript">
<code>// simple constructor to wrap objects for use with the API, returns
// the BKVO object. 
var prim = {},
    bprim = BKVO(prim);

// the original object is a property called ``object``.
assert(bprim.object === prim);

// the wrapped object can now observe, notify or sync with
// another object
bprim.observe('foo');
bprim.notify('bar');
bprim.sync('baz');
</code></pre>
            </div>
            <div id="example-pre">
                <code>assert(prim === bprim.object)</code><br>
                <span class="meta"></span>
            </div>
        </div>


        <h3>DOM to Model</h3>

        <div class="example">
            <div>
<pre class="javascript">
<code>// initialize a new model object 
var model = new Backbone.Model({ title: 'Hello World' });

// the model will observe the value of this input (the attribute
// is equal to the 'name' attribute on the input, i.e. 'title'
BKVO('input').sync(model);

// the span will observe the 'title' attribute on this model
BKVO('span').observe(model, 'title');

// if no interface is auto-detected for the model, the observer
// will be notified when _anything_ changes.
BKVO('.meta').observe(model, function() {
    return 'Last updated: ' + (new Date()).toString();
});
</code></pre>
            </div>

            <div id="example0-1">
                <input type="text" name="title">
                <span class="output"></span><br>
                <span class="meta"></span>
            </div>
        </div>

        <h3>DOM to DOM</h3>

        <p></p>

        <div class="example">
            <div>
<pre class="javascript"><code>// the ``span`` observes the ``input``. BKVO autodetects to use
// the "html" interface for the ``span`` and the "value" of  the
// ``input``. The event is auto-detected relative to the subject type,
// which will be "keyup".
BKVO('span').observe('input');
</code></pre>
            </div>

            <div id="example1-1">
                <input type="text">
                <span class="output"></span>
            </div>
        </div>

        <div class="example">
            <div>
<pre class="javascript"><code>// actionable objects (ones that have detectable events) can be 
// synced. that is, both are observing each other. this merely a
// convenience syntax and can be accomplished using two ``observe()``
// calls
BKVO('input.one').sync('input.two');
</code></pre>
            </div>

            <div id="example1-2">
                <input class="one" type="text">
                <input class="two" type="text">
            </div>
        </div>

        <div class="example">
            <div>
<pre class="javascript"><code>// interfaces can be explicitly set. this one reads, the ``:text``
// input will be "enabled" only when the ``:checkbox`` is "checked".
BKVO(':text').observe(':checkbox', {
    interface: {
        'enabled': 'checked'
    }
});</code></pre>
            </div>

            <div id="example1-3">
                <input type="checkbox">
                <input class="one" type="text" value="can you edit me?">
            </div>
        </div>

        <div class="example">
            <div>
<pre class="javascript"><code>// add a handler that takes the subject and value that has changed
// state as arguments. the returned values from the handler will be
// used as the value for the observers interface.
BKVO('span').observe('input', {
    interface: {'html': 'value'},
    handler: function(object, value) {
        if (value !== '')
            return 'I am a &lt;b&gt;' + value + '&lt;/b&gt;';
        return '&lt;em class="meta"&gt;please type something&lt;/em&gt;';
    }
});</code></pre>
            </div>

            <div id="example1-4">
                <input type="text">
                <span class="output"></span>
            </div>
        </div>

        <h3>Primitives</h3>

        <div class="example">
            <div>
<pre class="javascript"><code>// a simple primitive is keeping track of the
// value of the input field. the property will be the input's name
// attribute
var bprim = BKVO({}).observe('input').notify('span', {
    interface: {'text': 'foo'},
    event: 'change'
});

// to emulate the trigger, we just set an interval for every 100ms
setInterval(function() {
    bprim.object.trigger('change');
}, 100);

</code></pre>
            </div>

            <div id="example2-1">
                <input type="text" name="foo">
                <span></span>
            </div>
        </div>

        <script>
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-8483912-3']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>

    </body>
</html>

